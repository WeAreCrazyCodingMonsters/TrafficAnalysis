# 摘要		

 <div align="center"> <img src="fig/1.png" width = 800 height = 500 /> </div>

 <div align="center"> <img src="fig/2.png" width = 800 height = 750 /> </div>

 <div align="center"> <img src="fig/3.png" width = 800 height = 400 /> </div>

 <div align="center"> <img src="fig/4.png" width = 800 height = 400 /> </div>

通过用户OD数据表示的行程信息的分段任务主要可以划分为两个部分，分别是行程链划分和行程段识别。行程链划分是指通过分析用户行程点将连续的用户行程划分为离散的行程段, 而行程段识别是指将离散的行程段与用户的出行方式相映射。

  对于行程链划分问题，本文考虑使用五个属性，即[经度，纬度，时间点，速度，乘坐地铁的可能性]，来对一个行程点进行描述，然后通过基于高斯混合无监督聚类算法开发的时空-速度-权重-高斯混合聚类算法(TSSW聚类)对行程点进行聚类分析。其中，对于速度属性本文使用了KMeans聚类算法将连续的速度划分为十个离散的速度等级以增强聚类算法的易收敛性, 对于乘坐地铁的可能性本文设计了平滑的类Sigmoid函数来适应权重映射和反向梯度传播算法。

  对于行程段识别问题，本文考虑使用全连接神经网络实现五维属性到出行方式的非线性映射。

  除了在学术上的贡献，本文在软件工程领域也作出了贡献。在数据读取上，本文设计了Cache结构避免了对磁盘中的数据重复读取; 在轨迹处理上，本文去除了飘逸点并使用卡尔曼滤波对轨迹进行平滑处理; 在高精度定位上，本文实现了WGS84到GCJ02坐标系的高精度转换，坐标可以精确到小数点五位; 在可视化设计上，本文设计了五位数行动到三维空间的投影和高精地图标点; 在代码风格上，本文的代码严格符合“高内聚，低耦合”和面向对象的设计思想。

  综上, 本文以较高的软件工程水平实现了一个利用一种新的时空聚类方式TSSW聚类和神经网络技术的时空大数据分析系统, 实现了对用户出行链的分段, 识别, 评估。

# 环境配置

- `pandas == 2.0.3`：用于数据处理和分析。
- `webbrowser`：用于在默认浏览器中打开地图文件。
- `folium = 0.14.0`：用于地图可视化。
- `datetime`：用于处理时间数据。
- `os`：用于系统操作。
- `torch`: 用于神经网络构建和训练
- `transbigdata`: 用于轨迹处理

# 使用方法

## 行程链划分及可视化

人工划分：将经过时空聚类算法分类的簇与交通方式映射

`main.py cluster label`

神经网络：利用训练好的神经网络实现簇到交通方式的映射

`main.py cluster FCNN`

## 自动化用户轨迹标注与分析工具

`main.py Mission1`

## 神经网络训练

`main.py train`

# 文件说明

## main.py

主文件，主要有三项功能

1. 行程链划分及可视化，提供时空聚类分段方式和两种映射方式
   * 人工划分：将经过时空聚类算法分类的簇与交通方式映射
   * 神经网络：利用训练好的神经网络实现簇到交通方式的映射
2. 自动化用户轨迹标注与分析工具
3. 神经网络训练

## master.py

实现了自动化用户轨迹标注与分析工具

## fcnn_gpu.py

映射任务建模，模型的训练

## datasets.py

读取`data`目录下的文件，数据清洗，格式化等数据操作

## Network.py

用于构建和存储神经网络

## utils

该目录下放置子功能函数

### cluster.py

实现时空聚类

### interactional.py

负责与工作者交互

### map_builder.py

地图构建及标点
### tools.py

各种工具类函数，例如坐标转化，绘图，激活函数运算等。

## script

该目录下防止demo文件

### ComparisonCluster.py

比较三种聚类算法并可视化

### get_SubwayCoordinates.py

获得地铁站坐标

### iso_Forest.py

孤立森林算法demo，提供可视化

## data

存储数据集

## fig

存储绘图



